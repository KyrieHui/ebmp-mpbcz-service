### 1.1 预下单需求变更

##### 1.1.1 变更内容描述
1. 预下单服务新增积分相关逻辑

##### 1.1.2 输入字段变更
|序号|字段名称|中文含义|类型|长度|是否必输|数据项说明|
|30|pointCnt|积分数量|Integer||否| |
|List<point>结束:积分信息组|List<point>结束:积分信息组|List<point>结束:积分信息组|List<point>结束:积分信息组|List<point>结束:积分信息组|List<point>结束:积分信息组|List<point>结束:积分信息组|
|37|ordrRmrk|订单备注|String|32|否| |
|38|rtnAdr|回调地址|String|256|是|用于收银台关闭后回跳商户页面|
|39|advsAdr|通知地址|String|256|否|支付结果通知，固定地址，不需要上送|
|40|payrCpln|付款方姓名|String|32|否| |
|41|payrCertTpCd|付款方证件类型|String|2|否|01 身份证  |
|42|payrCertNo|付款方证件号|String|32|否| |
|43|payrMoblNo|付款方手机号|String|11|否| |
|44|payrMailNo|付款方邮箱|String|32|否| |
##### 1.1.3 执行逻辑变更
1. 判断请求数据中是否存在积分信息组，如果存在取积分汇总编号调用积分中心服务【汇总积分定义详情查询】查询汇总定义详细信息，如果积分中心报错，积分中心报错抛出，根据返回信息积分定义规则，计算请求中积分信息组积分抵扣金额总和，判断积分是否空耗，如果成本价<支付金额+权益金额，支付中心报错【错误码：MPBCZ0000216, 不能溢价销售】，如果成本价=支付金额+权益金额，积分就空耗，如果成本价>支付金额+权益金额,积分不空耗，但要校验积分抵扣金额是否大于差额（成本价-支付金额-权益金额）,大于时支付中心报错【错误码：MPBCZ0000215, 积分不能部分空耗】，如果小于差额，则需要计算银行垫款金额：成本价-支付金额-权益金额-积分金额。

2. 根据请求数据组装积分信息组入预下单积分信息表（t_prepay_point_inf）。
3. 组装交易创建请求数据，用户积分、用户权益、银行垫款通过扩展信息rights信息组进行透传核销，调用支付服务--【创建交易订单】-- 创建支付单信息，返回支付订单号，如果报错，异常直接抛出到调用方，成功后把支付订单号出入预下单表（t_prepay_order）。
##### 1.1.4 外部调用服务变更
|外部系统|接口类型|接口名称|
|积分中心|http|汇总积分定义详情查询|

##### 1.1.5 外部调用服务详情变更

### 积分汇总信息查询

### 积分汇总信息查询

| A | B | C | D | E |
|:-----|:------------|:-----|:----------------------------|:-|
| 服务名称 | 汇总积分_汇总积分查询 | 服务标识 | pointSumConfigInfoListPages |  |
| 服务描述 |  |  |  |  |
| 服务框架 | REST |  |  |  |
| 服务地址 | /ebmp/mpbcj/PointSumConfigInfoListPages/v1.0.0 |  |  |  |
| 输入参数 |  |  |  |  |
| 参数编码 | 参数名称 | 参数类型 | 是否必输 |  备注 |
| apprvStCd | 审批状态代码 | java.lang.String | 否 | 00有效、01待生效、02待审批、03待停用、04已停用/无效、05待更新 |
| sumPointNm | 汇总积分名称 | java.lang.String | 否 | 汇总积分名称 |
| pointTpCd | 积分类型编码 | java.lang.String | 否 | 积分类型编码 |
| pointStCd | 积分状态编码 | java.lang.String | 否 | 积分状态编码 |
| cretId | 创建人2 | java.lang.String | 否 |  |
| cretTm | 创建时间2 | java.lang.String | 否 |  |
| pageSize | 分页大小 | java.lang.String | 否 |  |
| endTm | 结束时间 | java.util.Date | 否 |  |
| pageIndex | 页码 | java.lang.String | 否 |  |
| belgOrgId | 归属机构编号 | java.lang.String | 否 |  |
| usrTpCd | 用户类型代码 | java.lang.String | 否 | 用户类型代码 |
| 输出参数 |  |  |  |  |
| pageSize | 分页大小 | java.lang.String | 否 |  |
| pageIndex | 页码 | java.lang.String | 否 |  |
| listPointPages | 汇总积分列表 | java.util.List | 否 | 汇总积分列表 |
| belgOrgId | 归属机构编号 | java.lang.String | 否 |  |
| modiId | 修改人2 | java.lang.String | 否 |  |
| cretTm | 创建时间2 | java.lang.String | 否 |  |
| cretId | 创建人2 | java.lang.String | 否 |  |
| modiTm | 修改时间 | java.util.Date | 否 |  |
| canEditFlg | 可编辑标志 | java.lang.String | 否 | 可编辑标志 |
| pointRglPrcCnt | 积分定价数量 | java.lang.Integer | 否 | 积分定价数量 |
| canRecallFlg | 可撤销标志 | java.lang.Integer | 否 | 可撤销标志 |
| canDelFlg | 可删除标志 | java.lang.Integer | 否 | 可删除标志 |
| flwId | 流程编号 | java.lang.String | 否 | 流程编号 |
| orgnlSumPointNm | 原汇总积分名称 | java.lang.String | 否 | 原汇总积分名称 |
| orgnlSumPointId | 原汇总积分编号 | java.lang.String | 否 | 原汇总积分编号 |
| modiOrgId | 修改人机构编号 | java.lang.String | 否 | 修改人机构编号 |
| cretOrgId | 创建人机构编号 | java.lang.String | 否 | 创建人机构编号 |
| pointRglPrcAmt | 积分定价金额 | java.math.BigDecimal | 否 | 积分定价金额 |
| pointRglPrcUnitCd | 积分定价单位编码 | java.lang.String | 否 | 积分定价单位编码 |
| suitOrgZoneId | 使用机构地区编号 | java.lang.String | 否 | 使用机构地区编号 |
| suitOrgZoneTpCd | 适用机构地区类型编码 | java.lang.String | 否 | 适用机构地区类型编码 |
| pointStCd | 积分状态编码 | java.lang.String | 否 | 积分状态编码 |
| pointTpCd | 积分类型编码 | java.lang.String | 否 | 积分类型编码 |
| sumPointNm | 汇总积分名称 | java.lang.String | 否 | 汇总积分名称 |
| sumPointId | 汇总积分编号 | java.lang.String | 否 | 汇总积分编号 |
| apprvStCd | 审批状态代码 | java.lang.String | 否 | 00有效、01待生效、02待审批、03待停用、04已停用/无效、05待更新 |
| usrTpCd | 用户类型代码 | java.lang.String | 否 | 用户类型代码 |
| useChnlCd | 使用渠道代码 | java.lang.String | 否 | 使用渠道代码 |
| modiNm | 修改人名称 | java.lang.String | 否 | 修改人名称 |

